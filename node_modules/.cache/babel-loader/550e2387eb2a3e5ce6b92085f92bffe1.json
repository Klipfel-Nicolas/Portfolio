{"ast":null,"code":"/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n\n ** three-trackballcontrols module\n ** @author Jon Lim / https://jonlim.ca\n */\nvar THREE = window.THREE || require('three');\n\nvar TrackballControls = function TrackballControls(object, domElement) {\n  // Pre-flight checks, with warnings / errors.\n  if (domElement === undefined) console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\n  if (domElement === document) console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n  var scope = this;\n  var STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    ZOOM: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_ZOOM_PAN: 4\n  };\n  this.object = object;\n  this.domElement = domElement; // API\n\n  this.enabled = true;\n  this.screen = {\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  };\n  this.rotateSpeed = 1.0;\n  this.zoomSpeed = 1.2;\n  this.panSpeed = 0.3;\n  this.noRotate = false;\n  this.noZoom = false;\n  this.noPan = false;\n  this.staticMoving = false;\n  this.dynamicDampingFactor = 0.2;\n  this.minDistance = 0;\n  this.maxDistance = Infinity;\n  /**\n   * `KeyboardEvent.keyCode` values which should trigger the different \n   * interaction states. Each element can be a single code or an array\n   * of codes. All elements are required.\n   */\n\n  this.keys = [65, // A \n  83, // S \n  68 // D\n  ];\n  /**\n   * `Event` for pointer interactions which should trigger different\n   * interaction states.\n   */\n\n  this.mouseButtons = {\n    LEFT: THREE.MOUSE.ROTATE,\n    MIDDLE: THREE.MOUSE.ZOOM,\n    RIGHT: THREE.MOUSE.PAN\n  }; // internals\n\n  this.target = new THREE.Vector3();\n  var EPS = 0.000001;\n  var lastPosition = new THREE.Vector3();\n\n  var _state = STATE.NONE,\n      _keyState = STATE.NONE,\n      _eye = new THREE.Vector3(),\n      _movePrev = new THREE.Vector2(),\n      _moveCurr = new THREE.Vector2(),\n      _lastAxis = new THREE.Vector3(),\n      _lastAngle = 0,\n      _zoomStart = new THREE.Vector2(),\n      _zoomEnd = new THREE.Vector2(),\n      _touchZoomDistanceStart = 0,\n      _touchZoomDistanceEnd = 0,\n      _panStart = new THREE.Vector2(),\n      _panEnd = new THREE.Vector2(); // for reset\n\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.up0 = this.object.up.clone();\n  this.zoom0 = this.object.zoom; // events\n\n  var changeEvent = {\n    type: 'change'\n  };\n  var startEvent = {\n    type: 'start'\n  };\n  var endEvent = {\n    type: 'end'\n  }; // methods\n\n  this.handleResize = function () {\n    var box = scope.domElement.getBoundingClientRect(); // Adjustments come from similar code in the jquery offset() function.\n\n    var d = scope.domElement.ownerDocument.documentElement;\n    scope.screen.left = box.left + window.pageXOffset - d.clientLeft;\n    scope.screen.top = box.top + window.pageYOffset - d.clientTop;\n    scope.screen.width = box.width;\n    scope.screen.height = box.height;\n  };\n\n  var getMouseOnScreen = function () {\n    var vector = new THREE.Vector2();\n    return function getMouseOnScreen(pageX, pageY) {\n      vector.set((pageX - scope.screen.left) / scope.screen.width, (pageY - scope.screen.top) / scope.screen.height);\n      return vector;\n    };\n  }();\n\n  var getMouseOnCircle = function () {\n    var vector = new THREE.Vector2();\n    return function getMouseOnCircle(pageX, pageY) {\n      vector.set((pageX - scope.screen.width * 0.5 - scope.screen.left) / (scope.screen.width * 0.5), (scope.screen.height + 2 * (scope.screen.top - pageY)) / scope.screen.width // screen.width intentional\n      );\n      return vector;\n    };\n  }();\n\n  this.rotateCamera = function () {\n    var axis = new THREE.Vector3(),\n        quaternion = new THREE.Quaternion(),\n        eyeDirection = new THREE.Vector3(),\n        objectUpDirection = new THREE.Vector3(),\n        objectSidewaysDirection = new THREE.Vector3(),\n        moveDirection = new THREE.Vector3(),\n        angle;\n    return function rotateCamera() {\n      moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\n      angle = moveDirection.length();\n\n      if (angle) {\n        _eye.copy(scope.object.position).sub(scope.target);\n\n        eyeDirection.copy(_eye).normalize();\n        objectUpDirection.copy(scope.object.up).normalize();\n        objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n        objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\n        objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\n        moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n        axis.crossVectors(moveDirection, _eye).normalize();\n        angle *= scope.rotateSpeed;\n        quaternion.setFromAxisAngle(axis, angle);\n\n        _eye.applyQuaternion(quaternion);\n\n        scope.object.up.applyQuaternion(quaternion);\n\n        _lastAxis.copy(axis);\n\n        _lastAngle = angle;\n      } else if (!scope.staticMoving && _lastAngle) {\n        _lastAngle *= Math.sqrt(1.0 - scope.dynamicDampingFactor);\n\n        _eye.copy(scope.object.position).sub(scope.target);\n\n        quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\n\n        _eye.applyQuaternion(quaternion);\n\n        scope.object.up.applyQuaternion(quaternion);\n      }\n\n      _movePrev.copy(_moveCurr);\n    };\n  }();\n\n  this.zoomCamera = function () {\n    var factor;\n\n    if (_state === STATE.TOUCH_ZOOM_PAN) {\n      factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n      _touchZoomDistanceStart = _touchZoomDistanceEnd;\n\n      _eye.multiplyScalar(factor);\n    } else {\n      factor = 1.0 + (_zoomEnd.y - _zoomStart.y) * scope.zoomSpeed;\n\n      if (factor !== 1.0 && factor > 0.0) {\n        _eye.multiplyScalar(factor);\n      }\n\n      if (scope.staticMoving) {\n        _zoomStart.copy(_zoomEnd);\n      } else {\n        _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\n      }\n    }\n  };\n\n  this.panCamera = function () {\n    var mouseChange = new THREE.Vector2(),\n        objectUp = new THREE.Vector3(),\n        pan = new THREE.Vector3();\n    return function panCamera() {\n      mouseChange.copy(_panEnd).sub(_panStart);\n\n      if (mouseChange.lengthSq()) {\n        mouseChange.multiplyScalar(_eye.length() * scope.panSpeed);\n        pan.copy(_eye).cross(scope.object.up).setLength(mouseChange.x);\n        pan.add(objectUp.copy(scope.object.up).setLength(mouseChange.y));\n        scope.object.position.add(pan);\n        scope.target.add(pan);\n\n        if (scope.staticMoving) {\n          _panStart.copy(_panEnd);\n        } else {\n          _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(scope.dynamicDampingFactor));\n        }\n      }\n    };\n  }();\n\n  this.checkDistances = function () {\n    if (!scope.noZoom || !scope.noPan) {\n      if (_eye.lengthSq() > scope.maxDistance * scope.maxDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.maxDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n\n      if (_eye.lengthSq() < scope.minDistance * scope.minDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.minDistance));\n\n        _zoomStart.copy(_zoomEnd);\n      }\n    }\n  };\n\n  this.update = function () {\n    _eye.subVectors(scope.object.position, scope.target);\n\n    if (!scope.noRotate) {\n      scope.rotateCamera();\n    }\n\n    if (!scope.noZoom) {\n      scope.zoomCamera();\n    }\n\n    if (!scope.noPan) {\n      scope.panCamera();\n    }\n\n    scope.object.position.addVectors(scope.target, _eye);\n    scope.checkDistances();\n    scope.object.lookAt(scope.target);\n\n    if (lastPosition.distanceToSquared(scope.object.position) > EPS) {\n      scope.dispatchEvent(changeEvent);\n      lastPosition.copy(scope.object.position);\n    }\n  };\n\n  this.reset = function () {\n    _state = STATE.NONE;\n    _keyState = STATE.NONE;\n    scope.target.copy(scope.target0);\n    scope.object.position.copy(scope.position0);\n    scope.object.up.copy(scope.up0);\n\n    _eye.subVectors(scope.object.position, scope.target);\n\n    scope.object.lookAt(scope.target);\n    scope.dispatchEvent(changeEvent);\n    lastPosition.copy(scope.object.position);\n  }; // Listeners\n\n\n  function onPointerDown(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n      case 'pen':\n        onMouseDown(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function onPointerMove(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n      case 'pen':\n        onMouseMove(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function onPointerUp(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n      case 'mouse':\n      case 'pen':\n        onMouseUp(event);\n        break;\n      // TODO touch\n    }\n  }\n\n  function keydown(event) {\n    if (scope.enabled === false) return;\n    window.removeEventListener('keydown', keydown);\n\n    if (_keyState !== STATE.NONE) {\n      return;\n    } else if (event.keyCode === scope.keys[STATE.ROTATE] && !scope.noRotate) {\n      _keyState = STATE.ROTATE;\n    } else if (event.keyCode === scope.keys[STATE.ZOOM] && !scope.noZoom) {\n      _keyState = STATE.ZOOM;\n    } else if (event.keyCode === scope.keys[STATE.PAN] && !scope.noPan) {\n      _keyState = STATE.PAN;\n    }\n  }\n\n  function keyup() {\n    if (scope.enabled === false) return;\n    _keyState = STATE.NONE;\n    window.addEventListener('keydown', keydown, false);\n  }\n\n  function onMouseDown(event) {\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (_state === STATE.NONE) {\n      switch (event.button) {\n        case scope.mouseButtons.LEFT:\n          _state = STATE.ROTATE;\n          break;\n\n        case scope.mouseButtons.MIDDLE:\n          _state = STATE.ZOOM;\n          break;\n\n        case scope.mouseButtons.RIGHT:\n          _state = STATE.PAN;\n          break;\n\n        default:\n          _state = STATE.NONE;\n      }\n    }\n\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n\n      _movePrev.copy(_moveCurr);\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n      _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _zoomEnd.copy(_zoomStart);\n    } else if (state === STATE.PAN && !scope.noPan) {\n      _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n      _panEnd.copy(_panStart);\n    }\n\n    scope.domElement.ownerDocument.addEventListener('pointermove', onPointerMove, false);\n    scope.domElement.ownerDocument.addEventListener('pointerup', onPointerUp, false);\n    scope.dispatchEvent(startEvent);\n  }\n\n  function onMouseMove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    var state = _keyState !== STATE.NONE ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n      _movePrev.copy(_moveCurr);\n\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n      _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    } else if (state === STATE.PAN && !scope.noPan) {\n      _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n    }\n  }\n\n  function onMouseUp(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n    _state = STATE.NONE;\n    scope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove);\n    scope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function mousewheel(event) {\n    if (scope.enabled === false) return;\n    if (scope.noZoom === true) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.deltaMode) {\n      case 2:\n        // Zoom in pages\n        _zoomStart.y -= event.deltaY * 0.025;\n        break;\n\n      case 1:\n        // Zoom in lines\n        _zoomStart.y -= event.deltaY * 0.01;\n        break;\n\n      default:\n        // undefined, 0, assume pixels\n        _zoomStart.y -= event.deltaY * 0.00025;\n        break;\n    }\n\n    scope.dispatchEvent(startEvent);\n    scope.dispatchEvent(endEvent);\n  }\n\n  function touchstart(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n\n    switch (event.touches.length) {\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n\n      default:\n        // 2 or more\n        _state = STATE.TOUCH_ZOOM_PAN;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panStart.copy(getMouseOnScreen(x, y));\n\n        _panEnd.copy(_panStart);\n\n        break;\n    }\n\n    scope.dispatchEvent(startEvent);\n  }\n\n  function touchmove(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n      case 1:\n        _movePrev.copy(_moveCurr);\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        break;\n\n      default:\n        // 2 or more\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n\n        _panEnd.copy(getMouseOnScreen(x, y));\n\n        break;\n    }\n  }\n\n  function touchend(event) {\n    if (scope.enabled === false) return;\n\n    switch (event.touches.length) {\n      case 0:\n        _state = STATE.NONE;\n        break;\n\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n\n        _movePrev.copy(_moveCurr);\n\n        break;\n    }\n\n    scope.dispatchEvent(endEvent);\n  }\n\n  function contextmenu(event) {\n    if (scope.enabled === false) return;\n    event.preventDefault();\n  }\n\n  this.dispose = function () {\n    scope.domElement.removeEventListener('contextmenu', contextmenu, false);\n    scope.domElement.removeEventListener('pointerdown', onPointerDown, false);\n    scope.domElement.removeEventListener('wheel', mousewheel, false);\n    scope.domElement.removeEventListener('touchstart', touchstart, false);\n    scope.domElement.removeEventListener('touchend', touchend, false);\n    scope.domElement.removeEventListener('touchmove', touchmove, false);\n    scope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove, false);\n    scope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp, false);\n    window.removeEventListener('keydown', keydown, false);\n    window.removeEventListener('keyup', keyup, false);\n  };\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false);\n  this.domElement.addEventListener('pointerdown', onPointerDown, false);\n  this.domElement.addEventListener('wheel', mousewheel, false);\n  this.domElement.addEventListener('touchstart', touchstart, false);\n  this.domElement.addEventListener('touchend', touchend, false);\n  this.domElement.addEventListener('touchmove', touchmove, false);\n  this.domElement.ownerDocument.addEventListener('pointermove', onPointerMove, false);\n  this.domElement.ownerDocument.addEventListener('pointerup', onPointerUp, false);\n  window.addEventListener('keydown', keydown, false);\n  window.addEventListener('keyup', keyup, false);\n  this.handleResize(); // force an update at start\n\n  this.update();\n};\n\nTrackballControls.prototype = Object.create(THREE.EventDispatcher.prototype);\nTrackballControls.prototype.constructor = TrackballControls;\nexport default TrackballControls;","map":{"version":3,"sources":["/Users/klipfelnicolas/Desktop/dossier web/Git Pro/Portfolio/node_modules/three-trackballcontrols/index.js"],"names":["THREE","window","require","TrackballControls","object","domElement","undefined","console","warn","document","error","scope","STATE","NONE","ROTATE","ZOOM","PAN","TOUCH_ROTATE","TOUCH_ZOOM_PAN","enabled","screen","left","top","width","height","rotateSpeed","zoomSpeed","panSpeed","noRotate","noZoom","noPan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","Infinity","keys","mouseButtons","LEFT","MOUSE","MIDDLE","RIGHT","target","Vector3","EPS","lastPosition","_state","_keyState","_eye","_movePrev","Vector2","_moveCurr","_lastAxis","_lastAngle","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","target0","clone","position0","position","up0","up","zoom0","zoom","changeEvent","type","startEvent","endEvent","handleResize","box","getBoundingClientRect","d","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","getMouseOnScreen","vector","pageX","pageY","set","getMouseOnCircle","rotateCamera","axis","quaternion","Quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","angle","x","y","length","copy","sub","normalize","crossVectors","setLength","add","setFromAxisAngle","applyQuaternion","Math","sqrt","zoomCamera","factor","multiplyScalar","panCamera","mouseChange","objectUp","pan","lengthSq","cross","subVectors","checkDistances","addVectors","update","lookAt","distanceToSquared","dispatchEvent","reset","onPointerDown","event","pointerType","onMouseDown","onPointerMove","onMouseMove","onPointerUp","onMouseUp","keydown","removeEventListener","keyCode","keyup","addEventListener","preventDefault","stopPropagation","button","state","mousewheel","deltaMode","deltaY","touchstart","touches","dx","dy","touchmove","touchend","contextmenu","dispose","prototype","Object","create","EventDispatcher","constructor"],"mappings":"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","sourcesContent":["/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n\n ** three-trackballcontrols module\n ** @author Jon Lim / https://jonlim.ca\n */\n\nconst THREE = window.THREE || require('three');\n\nconst TrackballControls = function (object, domElement) {\n  // Pre-flight checks, with warnings / errors.\n  if (domElement === undefined) console.warn('THREE.TrackballControls: The second parameter \"domElement\" is now mandatory.');\n  if (domElement === document) console.error('THREE.TrackballControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.');\n\n  const scope = this;\n  const STATE = {\n    NONE: -1,\n    ROTATE: 0,\n    ZOOM: 1,\n    PAN: 2,\n    TOUCH_ROTATE: 3,\n    TOUCH_ZOOM_PAN: 4,\n  };\n\n  this.object = object;\n  this.domElement = domElement;\n\n  // API\n\n  this.enabled = true;\n\n  this.screen = { left: 0, top: 0, width: 0, height: 0 };\n\n  this.rotateSpeed = 1.0;\n  this.zoomSpeed = 1.2;\n  this.panSpeed = 0.3;\n\n  this.noRotate = false;\n  this.noZoom = false;\n  this.noPan = false;\n\n  this.staticMoving = false;\n  this.dynamicDampingFactor = 0.2;\n\n  this.minDistance = 0;\n  this.maxDistance = Infinity;\n\n  /**\n   * `KeyboardEvent.keyCode` values which should trigger the different \n   * interaction states. Each element can be a single code or an array\n   * of codes. All elements are required.\n   */\n  this.keys = [\n    65, // A \n    83, // S \n    68, // D\n  ];\n\n  /**\n   * `Event` for pointer interactions which should trigger different\n   * interaction states.\n   */\n  this.mouseButtons = { \n    LEFT: THREE.MOUSE.ROTATE, \n    MIDDLE: THREE.MOUSE.ZOOM, \n    RIGHT: THREE.MOUSE.PAN,\n  };\n\n  // internals\n\n  this.target = new THREE.Vector3();\n\n  const EPS = 0.000001;\n\n  const lastPosition = new THREE.Vector3();\n\n  let _state = STATE.NONE,\n    _keyState = STATE.NONE,\n\n    _eye = new THREE.Vector3(),\n\n    _movePrev = new THREE.Vector2(),\n    _moveCurr = new THREE.Vector2(),\n\n    _lastAxis = new THREE.Vector3(),\n    _lastAngle = 0,\n\n    _zoomStart = new THREE.Vector2(),\n    _zoomEnd = new THREE.Vector2(),\n\n    _touchZoomDistanceStart = 0,\n    _touchZoomDistanceEnd = 0,\n\n    _panStart = new THREE.Vector2(),\n    _panEnd = new THREE.Vector2();\n\n  // for reset\n\n  this.target0 = this.target.clone();\n  this.position0 = this.object.position.clone();\n  this.up0 = this.object.up.clone();\n  this.zoom0 = this.object.zoom;\n\n  // events\n\n  var changeEvent = { type: 'change' };\n  var startEvent = { type: 'start' };\n  var endEvent = { type: 'end' };\n\n  // methods\n\n  this.handleResize = function () {\n\n    const box = scope.domElement.getBoundingClientRect();\n    // Adjustments come from similar code in the jquery offset() function.\n    const d = scope.domElement.ownerDocument.documentElement;\n    scope.screen.left = box.left + window.pageXOffset - d.clientLeft;\n    scope.screen.top = box.top + window.pageYOffset - d.clientTop;\n    scope.screen.width = box.width;\n    scope.screen.height = box.height;\n\n  };\n\n  const getMouseOnScreen = (function () {\n\n    const vector = new THREE.Vector2();\n    return function getMouseOnScreen(pageX, pageY) {\n      vector.set(\n        (pageX - scope.screen.left) / scope.screen.width,\n        (pageY - scope.screen.top) / scope.screen.height,\n      );\n\n      return vector;\n    };\n\n  }());\n\n  const getMouseOnCircle = (function () {\n\n    const vector = new THREE.Vector2();\n    return function getMouseOnCircle(pageX, pageY) {\n      vector.set(\n        ((pageX - scope.screen.width * 0.5 - scope.screen.left) / (scope.screen.width * 0.5)),\n        ((scope.screen.height + 2 * (scope.screen.top - pageY)) / scope.screen.width), // screen.width intentional\n      );\n\n      return vector;\n    };\n\n  }());\n\n  this.rotateCamera = (function () {\n\n    let axis = new THREE.Vector3(),\n      quaternion = new THREE.Quaternion(),\n      eyeDirection = new THREE.Vector3(),\n      objectUpDirection = new THREE.Vector3(),\n      objectSidewaysDirection = new THREE.Vector3(),\n      moveDirection = new THREE.Vector3(),\n      angle;\n\n    return function rotateCamera() {\n      moveDirection.set(_moveCurr.x - _movePrev.x, _moveCurr.y - _movePrev.y, 0);\n      angle = moveDirection.length();\n\n      if (angle) {\n\n        _eye.copy(scope.object.position).sub(scope.target);\n\n        eyeDirection.copy(_eye).normalize();\n        objectUpDirection.copy(scope.object.up).normalize();\n        objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n\n        objectUpDirection.setLength(_moveCurr.y - _movePrev.y);\n        objectSidewaysDirection.setLength(_moveCurr.x - _movePrev.x);\n\n        moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n\n        axis.crossVectors(moveDirection, _eye).normalize();\n\n        angle *= scope.rotateSpeed;\n        quaternion.setFromAxisAngle(axis, angle);\n\n        _eye.applyQuaternion(quaternion);\n        scope.object.up.applyQuaternion(quaternion);\n\n        _lastAxis.copy(axis);\n        _lastAngle = angle;\n\n      } else if (!scope.staticMoving && _lastAngle) {\n\n        _lastAngle *= Math.sqrt(1.0 - scope.dynamicDampingFactor);\n        _eye.copy(scope.object.position).sub(scope.target);\n        quaternion.setFromAxisAngle(_lastAxis, _lastAngle);\n        _eye.applyQuaternion(quaternion);\n        scope.object.up.applyQuaternion(quaternion);\n\n      }\n\n      _movePrev.copy(_moveCurr);\n    };\n\n  }());\n\n\n  this.zoomCamera = function () {\n\n    let factor;\n\n    if (_state === STATE.TOUCH_ZOOM_PAN) {\n\n      factor = _touchZoomDistanceStart / _touchZoomDistanceEnd;\n      _touchZoomDistanceStart = _touchZoomDistanceEnd;\n      _eye.multiplyScalar(factor);\n\n    } else {\n\n      factor = 1.0 + (_zoomEnd.y - _zoomStart.y) * scope.zoomSpeed;\n      if (factor !== 1.0 && factor > 0.0) {\n        _eye.multiplyScalar(factor);\n      }\n\n      if (scope.staticMoving) {\n        _zoomStart.copy(_zoomEnd);\n      } else {\n        _zoomStart.y += (_zoomEnd.y - _zoomStart.y) * this.dynamicDampingFactor;\n      }\n\n    }\n\n  };\n\n  this.panCamera = (function () {\n\n    let mouseChange = new THREE.Vector2(),\n      objectUp = new THREE.Vector3(),\n      pan = new THREE.Vector3();\n\n    return function panCamera() {\n      mouseChange.copy(_panEnd).sub(_panStart);\n\n      if (mouseChange.lengthSq()) {\n        mouseChange.multiplyScalar(_eye.length() * scope.panSpeed);\n\n        pan.copy(_eye).cross(scope.object.up).setLength(mouseChange.x);\n        pan.add(objectUp.copy(scope.object.up).setLength(mouseChange.y));\n\n        scope.object.position.add(pan);\n        scope.target.add(pan);\n\n        if (scope.staticMoving) {\n          _panStart.copy(_panEnd);\n        } else {\n          _panStart.add(mouseChange.subVectors(_panEnd, _panStart).multiplyScalar(scope.dynamicDampingFactor));\n        }\n      }\n\n    };\n\n  }());\n\n  this.checkDistances = function () {\n\n    if (!scope.noZoom || !scope.noPan) {\n\n      if (_eye.lengthSq() > scope.maxDistance * scope.maxDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.maxDistance));\n        _zoomStart.copy(_zoomEnd);\n      }\n\n      if (_eye.lengthSq() < scope.minDistance * scope.minDistance) {\n        scope.object.position.addVectors(scope.target, _eye.setLength(scope.minDistance));\n        _zoomStart.copy(_zoomEnd);\n      }\n\n    }\n\n  };\n\n  this.update = function () {\n\n    _eye.subVectors(scope.object.position, scope.target);\n\n    if (!scope.noRotate) {\n      scope.rotateCamera();\n    }\n\n    if (!scope.noZoom) {\n      scope.zoomCamera();\n    }\n\n    if (!scope.noPan) {\n      scope.panCamera();\n    }\n\n    scope.object.position.addVectors(scope.target, _eye);\n    scope.checkDistances();\n    scope.object.lookAt(scope.target);\n\n    if (lastPosition.distanceToSquared(scope.object.position) > EPS) {\n      scope.dispatchEvent(changeEvent);\n      lastPosition.copy(scope.object.position);\n    }\n\n  };\n\n  this.reset = function () {\n\n    _state = STATE.NONE;\n    _keyState = STATE.NONE;\n\n    scope.target.copy(scope.target0);\n    scope.object.position.copy(scope.position0);\n    scope.object.up.copy(scope.up0);\n\n    _eye.subVectors(scope.object.position, scope.target);\n\n    scope.object.lookAt(scope.target);\n\n    scope.dispatchEvent(changeEvent);\n\n    lastPosition.copy(scope.object.position);\n\n  };\n\n  // Listeners\n\n  function onPointerDown( event ) {\n\n\t\tif ( scope.enabled === false ) return;\n\n\t\tswitch ( event.pointerType ) {\n\n\t\t\tcase 'mouse':\n\t\t\tcase 'pen':\n\t\t\t\tonMouseDown( event );\n\t\t\t\tbreak;\n\n\t\t\t// TODO touch\n\n\t\t}\n\n\t}\n\n  function onPointerMove(event) {\n\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n\n      case 'mouse':\n      case 'pen':\n        onMouseMove(event);\n        break;\n\n      // TODO touch\n\n    }\n\n  }\n\n  function onPointerUp(event) {\n\n    if (scope.enabled === false) return;\n\n    switch (event.pointerType) {\n\n      case 'mouse':\n      case 'pen':\n        onMouseUp(event);\n        break;\n\n      // TODO touch\n\n    }\n\n  }\n\n  function keydown(event) {\n\n    if (scope.enabled === false) return;\n\n    window.removeEventListener('keydown', keydown);\n\n    if (_keyState !== STATE.NONE) {\n      return;\n    } else if (event.keyCode === scope.keys[STATE.ROTATE] && !scope.noRotate) {\n      _keyState = STATE.ROTATE;\n    } else if (event.keyCode === scope.keys[STATE.ZOOM] && !scope.noZoom) {\n      _keyState = STATE.ZOOM;\n    } else if (event.keyCode === scope.keys[STATE.PAN] && !scope.noPan) {\n      _keyState = STATE.PAN;\n    }\n\n  }\n\n  function keyup() {\n\n    if (scope.enabled === false) return;\n\n    _keyState = STATE.NONE;\n\n    window.addEventListener('keydown', keydown, false);\n\n  }\n\n  function onMouseDown(event) {\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    if (_state === STATE.NONE) {\n\n      switch (event.button) {\n        case scope.mouseButtons.LEFT:\n          _state = STATE.ROTATE;\n          break;\n\n        case scope.mouseButtons.MIDDLE:\n          _state = STATE.ZOOM;\n          break;\n\n        case scope.mouseButtons.RIGHT:\n          _state = STATE.PAN;\n          break;\n\n        default:\n          _state = STATE.NONE;\n      }\n\n    }\n\n    const state = (_keyState !== STATE.NONE) ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n      _movePrev.copy(_moveCurr);\n\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n\n      _zoomStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n      _zoomEnd.copy(_zoomStart);\n\n    } else if (state === STATE.PAN && !scope.noPan) {\n\n      _panStart.copy(getMouseOnScreen(event.pageX, event.pageY));\n      _panEnd.copy(_panStart);\n\n    }\n\n    scope.domElement.ownerDocument.addEventListener('pointermove', onPointerMove, false);\n    scope.domElement.ownerDocument.addEventListener('pointerup', onPointerUp, false);\n\n    scope.dispatchEvent(startEvent);\n\n  }\n\n  function onMouseMove(event) {\n\n    if (scope.enabled === false) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    const state = (_keyState !== STATE.NONE) ? _keyState : _state;\n\n    if (state === STATE.ROTATE && !scope.noRotate) {\n\n      _movePrev.copy(_moveCurr);\n      _moveCurr.copy(getMouseOnCircle(event.pageX, event.pageY));\n\n    } else if (state === STATE.ZOOM && !scope.noZoom) {\n\n      _zoomEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n    } else if (state === STATE.PAN && !scope.noPan) {\n\n      _panEnd.copy(getMouseOnScreen(event.pageX, event.pageY));\n\n    }\n\n  }\n\n  function onMouseUp(event) {\n\n    if (scope.enabled === false) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    _state = STATE.NONE;\n\n    scope.domElement.ownerDocument.removeEventListener('pointermove', onPointerMove);\n    scope.domElement.ownerDocument.removeEventListener('pointerup', onPointerUp);\n    scope.dispatchEvent(endEvent);\n\n  }\n\n  function mousewheel(event) {\n\n    if (scope.enabled === false) return;\n    if (scope.noZoom === true) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.deltaMode) {\n\n      case 2:\n        // Zoom in pages\n        _zoomStart.y -= event.deltaY * 0.025;\n        break;\n\n      case 1:\n        // Zoom in lines\n        _zoomStart.y -= event.deltaY * 0.01;\n        break;\n\n      default:\n        // undefined, 0, assume pixels\n        _zoomStart.y -= event.deltaY * 0.00025;\n        break;\n\n    }\n\n    scope.dispatchEvent(startEvent);\n    scope.dispatchEvent(endEvent);\n\n  }\n\n  function touchstart(event) {\n\n    if (scope.enabled === false) return;\n\n    event.preventDefault();\n\n    switch (event.touches.length) {\n\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n        _movePrev.copy(_moveCurr);\n        break;\n\n      default: // 2 or more\n        _state = STATE.TOUCH_ZOOM_PAN;\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = _touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n        _panStart.copy(getMouseOnScreen(x, y));\n        _panEnd.copy(_panStart);\n        break;\n\n    }\n\n    scope.dispatchEvent(startEvent);\n\n  }\n\n  function touchmove(event) {\n\n    if (scope.enabled === false) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n\n      case 1:\n        _movePrev.copy(_moveCurr);\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n        break;\n\n      default: // 2 or more\n        var dx = event.touches[0].pageX - event.touches[1].pageX;\n        var dy = event.touches[0].pageY - event.touches[1].pageY;\n        _touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n\n        var x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n        var y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n        _panEnd.copy(getMouseOnScreen(x, y));\n        break;\n\n    }\n\n  }\n\n  function touchend(event) {\n\n    if (scope.enabled === false) return;\n\n    switch (event.touches.length) {\n\n      case 0:\n        _state = STATE.NONE;\n        break;\n\n      case 1:\n        _state = STATE.TOUCH_ROTATE;\n        _moveCurr.copy(getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n        _movePrev.copy(_moveCurr);\n        break;\n\n    }\n\n    scope.dispatchEvent(endEvent);\n\n  }\n\n  function contextmenu(event) {\n\n    if (scope.enabled === false) return;\n\n    event.preventDefault();\n\n  }\n\n  this.dispose = function () {\n\n    scope.domElement.removeEventListener('contextmenu', contextmenu, false);\n    scope.domElement.removeEventListener('pointerdown', onPointerDown, false);\n    scope.domElement.removeEventListener('wheel', mousewheel, false);\n\n    scope.domElement.removeEventListener('touchstart', touchstart, false);\n    scope.domElement.removeEventListener('touchend', touchend, false);\n    scope.domElement.removeEventListener('touchmove', touchmove, false);\n\n    scope.domElement.ownerDocument.removeEventListener( 'pointermove', onPointerMove, false );\n\t\tscope.domElement.ownerDocument.removeEventListener( 'pointerup', onPointerUp, false );\n\n    window.removeEventListener('keydown', keydown, false);\n    window.removeEventListener('keyup', keyup, false);\n\n  };\n\n  this.domElement.addEventListener('contextmenu', contextmenu, false);\n\n  this.domElement.addEventListener('pointerdown', onPointerDown, false);\n  this.domElement.addEventListener('wheel', mousewheel, false);\n\n  this.domElement.addEventListener('touchstart', touchstart, false);\n  this.domElement.addEventListener('touchend', touchend, false);\n  this.domElement.addEventListener('touchmove', touchmove, false);\n\n  this.domElement.ownerDocument.addEventListener( 'pointermove', onPointerMove, false );\n\tthis.domElement.ownerDocument.addEventListener( 'pointerup', onPointerUp, false );\n\n  window.addEventListener('keydown', keydown, false);\n  window.addEventListener('keyup', keyup, false);\n\n  this.handleResize();\n\n  // force an update at start\n  this.update();\n\n};\n\nTrackballControls.prototype = Object.create(THREE.EventDispatcher.prototype);\nTrackballControls.prototype.constructor = TrackballControls;\n\nexport default TrackballControls;"]},"metadata":{},"sourceType":"module"}